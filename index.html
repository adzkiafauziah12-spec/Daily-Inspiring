<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Daily Inspiring - Cloud Katalog</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap');
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #fdf2f8;
            margin: 0;
            padding: 0;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
        }
        .modal.active { display: flex; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="min-h-screen">

    <!-- Tombol Admin Darurat (Paling Atas) -->
    <div class="bg-slate-800 text-white text-[10px] py-1 text-center font-bold tracking-widest cursor-pointer" onclick="openLogin()">
        KLIK DI SINI UNTUK LOGIN ADMIN
    </div>

    <!-- Header -->
    <header class="bg-white border-b border-pink-100 sticky top-0 z-50 shadow-sm">
        <div class="max-w-xl mx-auto px-5 h-16 flex items-center justify-between">
            <h1 class="text-pink-600 font-bold text-lg flex items-center gap-2">
                <span class="bg-pink-500 text-white w-8 h-8 rounded-lg flex items-center justify-center">D</span>
                Daily Inspiring
            </h1>
            <div id="adminBadge" class="hidden bg-pink-100 text-pink-600 px-3 py-1 rounded-full text-[10px] font-bold">MODE EDIT</div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-xl mx-auto px-5 py-6 pb-32">
        <!-- Search -->
        <div class="mb-6">
            <input type="text" id="searchInput" oninput="renderItems()"
                class="w-full bg-white border border-pink-100 rounded-2xl py-4 px-5 text-sm outline-none focus:ring-2 focus:ring-pink-400" 
                placeholder="Cari produk favoritmu...">
        </div>

        <!-- Filter Kategori -->
        <div id="categoryTabs" class="flex gap-2 overflow-x-auto no-scrollbar mb-8">
            <button onclick="filterCategory('Semua')" class="px-5 py-2 rounded-xl text-xs font-bold bg-pink-500 text-white whitespace-nowrap">Semua</button>
            <!-- Dinamis dari JS -->
        </div>

        <!-- List Produk -->
        <div id="productList" class="grid grid-cols-1 gap-4">
            <!-- Dinamis dari JS -->
            <div class="text-center py-10 text-pink-300">Menghubungkan ke Cloud...</div>
        </div>
    </main>

    <!-- Floating Add Button (Admin Only) -->
    <div id="adminActions" class="hidden fixed bottom-6 right-6 flex flex-col gap-3 items-end z-[100]">
        <button onclick="openAddModal()" class="bg-pink-600 text-white p-4 rounded-2xl shadow-2xl flex items-center gap-2 font-bold active:scale-95">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="3"><path d="M12 5v14M5 12h14"/></svg>
            TAMBAH PRODUK
        </button>
        <button onclick="logout()" class="bg-slate-800 text-white text-[10px] px-4 py-2 rounded-lg shadow-xl font-bold">LOGOUT</button>
    </div>

    <!-- Modal Login -->
    <div id="loginModal" class="modal">
        <div class="bg-white w-full max-w-[300px] rounded-3xl p-8 shadow-2xl mx-4">
            <h3 class="font-bold text-center mb-4">Login Admin</h3>
            <input type="password" id="passInput" class="w-full bg-slate-100 p-3 rounded-xl border-none text-center mb-4 font-bold" placeholder="Password">
            <button onclick="verifyLogin()" class="w-full bg-pink-500 text-white font-bold py-3 rounded-xl shadow-lg active:scale-95">MASUK</button>
            <button onclick="closeLogin()" class="w-full text-slate-400 text-[10px] mt-4 font-bold uppercase">BATAL</button>
        </div>
    </div>

    <!-- Modal Tambah Produk -->
    <div id="addModal" class="modal">
        <div class="bg-white w-full max-w-md rounded-t-[2.5rem] sm:rounded-3xl p-8 mx-0 sm:mx-4 self-end sm:self-center max-h-[90vh] overflow-y-auto shadow-2xl">
            <h3 class="font-bold text-xl mb-6">Input Produk Baru</h3>
            <div class="space-y-4">
                <input type="text" id="p_title" class="w-full bg-slate-50 p-4 rounded-2xl border border-slate-100" placeholder="Nama Produk">
                <input type="text" id="p_cat" class="w-full bg-slate-50 p-4 rounded-2xl border border-slate-100" placeholder="Kategori (contoh: Fashion)">
                <input type="text" id="p_image" class="w-full bg-slate-50 p-4 rounded-2xl border border-slate-100" placeholder="Link Gambar (https://...)">
                <input type="text" id="p_link" class="w-full bg-slate-50 p-4 rounded-2xl border border-slate-100" placeholder="Link Shopee (https://shope.ee/...)">
                <button onclick="saveToCloud()" class="w-full bg-pink-600 text-white font-bold py-4 rounded-2xl shadow-xl active:scale-95">SIMPAN KE CLOUD</button>
                <button onclick="closeAddModal()" class="w-full text-slate-400 font-bold text-xs uppercase">TUTUP</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // Global State
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'daily-inspiring';
        
        let allItems = [];
        let currentCategory = 'Semua';
        let isAdmin = false;

        // --- AUTH & CLOUD ---
        async function initApp() {
            await signInAnonymously(auth);
            
            // Periksa status login sebelumnya
            if (localStorage.getItem('is_admin_logged') === 'true') {
                toggleAdminUI(true);
            }

            // Sync Data Produk
            const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'products');
            onSnapshot(colRef, (snap) => {
                allItems = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                allItems.sort((a,b) => (b.createdAt || 0) - (a.createdAt || 0));
                renderItems();
                renderCategories();
            });
        }

        // --- LOGIC UI (Pure JS) ---
        window.openLogin = () => document.getElementById('loginModal').classList.add('active');
        window.closeLogin = () => document.getElementById('loginModal').classList.remove('active');
        
        window.verifyLogin = () => {
            const pass = document.getElementById('passInput').value;
            if (pass === 'pinkadmin') {
                toggleAdminUI(true);
                localStorage.setItem('is_admin_logged', 'true');
                closeLogin();
            } else {
                alert("Password Salah!");
            }
        };

        window.logout = () => {
            toggleAdminUI(false);
            localStorage.removeItem('is_admin_logged');
        };

        function toggleAdminUI(status) {
            isAdmin = status;
            document.getElementById('adminBadge').style.display = status ? 'block' : 'none';
            document.getElementById('adminActions').style.display = status ? 'flex' : 'none';
            renderItems(); // re-render untuk memunculkan tombol hapus
        }

        window.filterCategory = (cat) => {
            currentCategory = cat;
            renderItems();
            renderCategories();
        };

        window.renderCategories = () => {
            const cats = ['Semua', ...new Set(allItems.map(i => i.category).filter(c => c))];
            const container = document.getElementById('categoryTabs');
            container.innerHTML = cats.map(c => `
                <button onclick="filterCategory('${c}')" 
                    class="px-5 py-2.5 rounded-xl text-xs font-bold whitespace-nowrap border border-pink-100 transition-all 
                    ${currentCategory === c ? 'bg-pink-500 text-white' : 'bg-white text-pink-400'}">
                    ${c}
                </button>
            `).join('');
        };

        window.renderItems = () => {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allItems.filter(i => {
                const matchesSearch = i.title.toLowerCase().includes(search);
                const matchesCat = currentCategory === 'Semua' || i.category === currentCategory;
                return matchesSearch && matchesCat;
            });

            const list = document.getElementById('productList');
            if (filtered.length === 0) {
                list.innerHTML = `<div class="text-center py-10 text-slate-400">Belum ada produk.</div>`;
                return;
            }

            list.innerHTML = filtered.map(item => `
                <div class="bg-white rounded-3xl p-4 border border-pink-50 shadow-sm flex items-center gap-4 relative">
                    <div class="w-20 h-20 bg-pink-50 rounded-2xl overflow-hidden flex-shrink-0">
                        <img src="${item.image}" class="w-full h-full object-cover" onerror="this.src='https://via.placeholder.com/150'">
                    </div>
                    <div class="flex-grow">
                        <p class="text-[8px] font-black text-pink-500 uppercase tracking-widest mb-1">${item.category || 'PRODUK'}</p>
                        <h3 class="text-sm font-bold text-slate-800 line-clamp-2 leading-tight mb-3">${item.title}</h3>
                        <a href="${item.link}" target="_blank" class="inline-block bg-pink-500 text-white px-5 py-2 rounded-xl text-[10px] font-bold shadow-lg shadow-pink-100">CEK PRODUK</a>
                    </div>
                    ${isAdmin ? `<button onclick="deleteProduct('${item.id}')" class="absolute top-2 right-2 text-red-300">Ã—</button>` : ''}
                </div>
            `).join('');
        };

        window.openAddModal = () => document.getElementById('addModal').classList.add('active');
        window.closeAddModal = () => document.getElementById('addModal').classList.remove('active');

        window.saveToCloud = async () => {
            const title = document.getElementById('p_title').value;
            const cat = document.getElementById('p_cat').value;
            const image = document.getElementById('p_image').value;
            const link = document.getElementById('p_link').value;

            if (!title || !link) return alert("Nama dan Link wajib diisi!");

            try {
                const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'products');
                await addDoc(colRef, {
                    title, category: cat, image, link,
                    createdAt: Date.now()
                });
                closeAddModal();
                // Reset Form
                document.getElementById('p_title').value = '';
                document.getElementById('p_cat').value = '';
                document.getElementById('p_image').value = '';
                document.getElementById('p_link').value = '';
            } catch (e) {
                alert("Gagal menyimpan!");
            }
        };

        window.deleteProduct = async (id) => {
            if (!confirm("Hapus produk ini dari cloud?")) return;
            try {
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'products', id);
                await deleteDoc(docRef);
            } catch (e) { alert("Gagal hapus!"); }
        };

        // Start App
        initApp();
    </script>
</body>
</html>

